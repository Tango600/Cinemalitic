Declare=PrintFDQuery;
SetValue=PrintFDQuery=select FD.delivery_num, c.agreement_date, coalesce(bd.short_name, t.cinema_name || ' *') cinema_name, F.film_name, coalesce('с ' || DATE2STR(fc.roll_date_begin) || ' по ', '') || coalesce(DATE2STR(fc.roll_date_end), '') roll_dates, mt.media_name from FILMS_TO_CONTRACTS FC left join FILMS F on FC.FILM_ID = F.ID_FILM left join FILMS_DELIVERYS FD on FC.CONTRACT_ID = FD.CONTRACT_ID and FC.FILM_ID = FD.FILM_ID left join CONTRACTS C on C.contract_id = fd.contract_id left join theaters t on c.cinema_id = t.cinema_id left join media_type mt on c.media_type_id = mt.med_id left join (select bd1.short_name, bd1.partner_id from bank_details bd1 where bd1.is_delete = 0 order by bd1.is_default desc) bd on c.cinema_id = bd.partner_id where fd.film_id is not null;